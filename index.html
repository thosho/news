<!DOCTYPE html>
<html lang="ta">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tamil News Reader - Frontend Only</title>
    <style>
        :root { --bg: #f0f2f5; --text: #1c1e21; --accent: #d63031; --card: #ffffff; }
        [data-theme="dark"] { --bg: #18191a; --text: #e4e6eb; --accent: #ff7675; --card: #242526; }

        body { margin: 0; font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); color: var(--text); overflow: hidden; }
        
        .header {
            position: fixed; top: 0; width: 100%; height: 60px;
            background: var(--card); display: flex; align-items: center; 
            justify-content: space-between; padding: 0 20px; z-index: 1000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .nav-tabs {
            position: fixed; top: 60px; width: 100%; height: 50px;
            background: var(--card); display: flex; overflow-x: auto;
            border-bottom: 1px solid rgba(0,0,0,0.1); z-index: 900;
        }
        .tab { 
            padding: 12px 20px; white-space: nowrap; cursor: pointer; 
            border-bottom: 3px solid transparent; opacity: 0.7; font-weight: bold;
        }
        .tab.active { border-bottom-color: var(--accent); opacity: 1; color: var(--accent); }

        .feed { height: 100vh; overflow-y: scroll; scroll-snap-type: y mandatory; padding-top: 110px; }
        .news-card { height: calc(100vh - 110px); scroll-snap-align: start; display: flex; align-items: center; justify-content: center; padding: 20px; box-sizing: border-box; }
        .box { background: var(--card); padding: 25px; border-radius: 15px; max-width: 500px; width: 100%; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        
        h3 { margin-top: 0; line-height: 1.4; color: var(--accent); }
        p { line-height: 1.8; font-size: 1.1rem; }

        .active-sentence { background: #fff176; color: #000; border-radius: 4px; padding: 0 2px; }
        
        .controls {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            background: var(--accent); padding: 12px 25px; border-radius: 40px;
            display: flex; gap: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.3); z-index: 2000;
        }
        .controls button { background: none; border: none; color: white; font-size: 1.4rem; cursor: pointer; }
    </style>
</head>
<body data-theme="light">

    <div class="header">
        <b style="font-size: 1.3rem;">‡Æö‡ØÜ‡ÆØ‡Øç‡Æ§‡Æø ‡Æµ‡Ææ‡Æö‡Æø‡Æ™‡Øç‡Æ™‡Ææ‡Æ≥‡Æ∞‡Øç (News Reader)</b>
        <button onclick="toggleTheme()" style="background:none; border:none; font-size:1.5rem; cursor:pointer;">üåì</button>
    </div>

    <div class="nav-tabs" id="tabs">
        <div class="tab active" onclick="loadNews('https://www.dailythanthi.com/rss/News/TopNews', this)">Trending</div>
        <div class="tab" onclick="loadNews('https://www.dailythanthi.com/rss/News/State/TamilNadu', this)">Tamil Nadu</div>
        <div class="tab" onclick="loadNews('https://www.dailythanthi.com/rss/Sports/Cricket', this)">Sports</div>
        <div class="tab" onclick="loadNews('http://feeds.bbci.co.uk/news/rss.xml', this)">English (World)</div>
    </div>

    <div class="feed" id="feed">
        <div class="news-card"><div class="box">‡Æö‡ØÜ‡ÆØ‡Øç‡Æ§‡Æø‡Æï‡Æ≥‡Øç ‡Æè‡Æ±‡Øç‡Æ±‡Æ™‡Øç‡Æ™‡Æü‡ØÅ‡Æï‡Æø‡Æ©‡Øç‡Æ±‡Æ©...</div></div>
    </div>

    <div class="controls">
        <button onclick="move(-1)">‚èÆÔ∏è</button>
        <button id="play-btn" onclick="togglePlay()">‚ñ∂Ô∏è Play</button>
        <button onclick="move(1)">‚è≠Ô∏è</button>
    </div>

    <script>
        const synth = window.speechSynthesis;
        let articles = [];
        let currentIdx = 0;
        let isPlaying = false;

        // Using a public RSS to JSON converter to bypass CORS
        async function loadNews(rssUrl, tabEl) {
            if(tabEl) {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tabEl.classList.add('active');
            }
            
            const apiUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(rssUrl)}`;
            
            try {
                const res = await fetch(apiUrl);
                const data = await res.json();
                articles = data.items;
                renderNews();
            } catch (e) {
                alert("Error loading news. Please try again later.");
            }
        }

        function renderNews() {
            const feed = document.getElementById('feed');
            feed.innerHTML = '';
            
            articles.forEach((item, i) => {
                // Split text into sentences for highlighting
                const text = item.description || item.content || "‡Æµ‡Æø‡Æµ‡Æ∞‡ÆÆ‡Øç ‡Æá‡Æ≤‡Øç‡Æ≤‡Øà.";
                const cleanText = text.replace(/<[^>]*>?/gm, ''); // Remove HTML tags
                const sentences = cleanText.split(/(?<=[.!?])\s+/);
                
                const wrappedSentences = sentences.map((s, si) => 
                    `<span class="sentence" id="s-${i}-${si}">${s}</span>`
                ).join(' ');

                feed.innerHTML += `
                    <div class="news-card" id="card-${i}">
                        <div class="box">
                            <h3>${item.title}</h3>
                            <p>${wrappedSentences}</p>
                        </div>
                    </div>
                `;
            });
            currentIdx = 0;
            feed.scrollTo(0, 0);
        }

        function getTamilVoice() {
            const voices = synth.getVoices();
            return voices.find(v => v.name.includes('Valluvar') || v.lang === 'ta-IN') || 
                   voices.find(v => v.lang.startsWith('ta'));
        }

        function speak() {
            if (currentIdx >= articles.length) { isPlaying = false; updateBtn(); return; }

            // Scroll to the current card
            document.getElementById(`card-${currentIdx}`).scrollIntoView({ behavior: 'smooth' });

            const textToRead = document.querySelector(`#card-${currentIdx} p`).innerText;
            const utt = new SpeechSynthesisUtterance(textToRead);
            const spans = document.querySelectorAll(`#card-${currentIdx} .sentence`);
            
            utt.voice = getTamilVoice();
            utt.lang = 'ta-IN';
            utt.rate = 0.9;

            utt.onboundary = (event) => {
                let charCount = 0;
                spans.forEach(span => {
                    const len = span.innerText.length + 1;
                    if (event.charIndex >= charCount && event.charIndex < charCount + len) {
                        document.querySelectorAll('.sentence').forEach(s => s.classList.remove('active-sentence'));
                        span.classList.add('active-sentence');
                    }
                    charCount += len;
                });
            };

            utt.onend = () => {
                if (isPlaying) {
                    currentIdx++;
                    setTimeout(speak, 1000);
                }
            };

            synth.speak(utt);
        }

        function togglePlay() {
            if (isPlaying) {
                synth.cancel();
                isPlaying = false;
            } else {
                isPlaying = true;
                speak();
            }
            updateBtn();
        }

        function move(dir) {
            synth.cancel();
            currentIdx = Math.max(0, Math.min(articles.length - 1, currentIdx + dir));
            if (isPlaying) speak();
            else document.getElementById(`card-${currentIdx}`).scrollIntoView({ behavior: 'smooth' });
        }

        function updateBtn() {
            document.getElementById('play-btn').innerText = isPlaying ? "‚è∏Ô∏è Pause" : "‚ñ∂Ô∏è Play";
        }

        function toggleTheme() {
            const b = document.body;
            b.setAttribute('data-theme', b.getAttribute('data-theme') === 'light' ? 'dark' : 'light');
        }

        // Initialize
        window.speechSynthesis.onvoiceschanged = () => getTamilVoice();
        loadNews('https://www.dailythanthi.com/rss/News/TopNews');
    </script>
</body>
</html>
